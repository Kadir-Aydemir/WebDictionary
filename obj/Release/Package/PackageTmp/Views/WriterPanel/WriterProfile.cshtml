@model EntityLayer.Concrete.Writer
@{
    ViewBag.Title = "WriterProfile";
    Layout = "~/Views/Shared/_WriterLayout.cshtml";
}
<style>
    @@import url('https://fonts.googleapis.com/css2?family=Kanit&display=swap');

    .customtext {
        font-family: 'Kanit', sans-serif;
        font-size: 55px;
        background: linear-gradient(to left, #572ADE 0%, #12A77F 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 20px;
    }

    .center-div {
        display: flex;
        justify-content: center;
    }

        .center-div .customtext {
            font-family: 'Kanit', sans-serif;
            font-size: 55px;
            background: linear-gradient(to left, #572ADE 0%, #12A77F 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

    .customtext2 {
        font-size: 13px;
        margin-bottom: 10px;
    }

    .card {
        font-family: 'Kanit', sans-serif;
        background-color: #181A1F;
        color: #9FA0A2;
        box-shadow: none;
        margin-bottom: 0;
    }

    .form-group {
        font-family: 'Kanit', sans-serif;
        padding-inline: 25px;
    }

        .form-group .form-control {
            color: #9FA0A2;
            border: 2px solid #0000;
            border-radius: 8px;
            background: linear-gradient(#181A1F,#181A1F) padding-box, linear-gradient(to left,#572ADE,#12A77F) border-box;
            margin-block: 12px;
        }

            .form-group .form-control:hover {
                background: linear-gradient(#181A1F,#181A1F) padding-box, linear-gradient(to left,#12A77F,#12A77F) border-box;
            }

    .image-containerr {
        display: inline-flex;
        align-items: flex-start;
        text-align: center;
        position: relative;
        width: 202px;
        height: 202px;
        border-radius: 5px;      
    }

    #cancelImagebutton {
        position: absolute;
        top: 5px;
        right: 5px;
    }

    @@media (max-width: 479.98px) {
        .customtext {
            font-size: 35px;
        }

        .form-group {
            padding-inline: 0;
        }

        .customtext2 {
            font-size: 10px;
        }
    }

    .img-container img {
        max-width: 100%;
    }

    .modal {
        font-family: 'Kanit', sans-serif;
        color: #9FA0A2;
    }

    #hide-div {
        position: absolute;
        top: 20px;
        right: 20px;
        border-radius: 30%;
    }

    #welcome-div {
        display: inline-flex;
        align-items: flex-start;
        text-align: center;
        position: relative;
        background-color: #181A1F;
        color: #9FA0A2;
        border-radius: 40px;
        overflow-y: hidden;
        overflow-x: hidden;
    }

    .home-button {
        color: white;
        background: linear-gradient(to left,#572ADE,#12A77F) padding-box, linear-gradient(to left,#572ADE,#12A77F) border-box;
        border-color: transparent;
        width: auto;
    }
</style>
<link href="~/AdminLTE-3.0.4/cropper.css" rel="stylesheet" />

@if (ViewBag.comeback == "true" || ViewBag.newMember == "true")
{
    <div class="row" id="welcome-div">
        <section class="col-lg-4">
            <!-- Custom tabs (Charts with tabs)-->
            <div class="card">
                <div class="card-body" style="height: 100%; max-width: 100%; max-height: 100%; text-align: center; display: flex; justify-content: center; ">
                    <lottie-player src="https://assets6.lottiefiles.com/private_files/lf30_Mc7l5D.json"
                                   background="transparent" speed="1" style="max-height: 260px;max-width:260px;" loop autoplay></lottie-player>
                </div>
            </div>
        </section>
        <section class="col-lg-8">
            <div class="card">
                <div class="card-body" style="height: 100%; max-width: 100%; max-height: 100%; text-align: center;padding:40px;">
                    @if (ViewBag.comeback == "true")
                    {
                        <div style="" class="customtext">Heey, welcome back..</div>
                        <p>
                            We are very happy to see you with us again.
                            You've lost enough time, just take a look at what's going on in space.
                            New headings and contents are waiting for you.
                            Enjoy it..
                        </p>
                    }
                    @if (ViewBag.newMember == "true")
                    {
                        <div style="" class="customtext">Welcome to Dictionary</div>
                        <p>
                            Here's another person who has left the world.
                            We are so happy that you joined us.
                            Remember that we are a family community in this space and respect is very important in the community.
                            You and many writers like you leave their traces in history here.
                            Now go back to the Dictionary and enlighten the community with your ideas.
                        </p>
                    }
                    <a href="/DictionaryPanel/Index" class="btn btn-dark home-button" style="margin-top:5px;">Go to Dictionary</a>
                </div>
            </div>
        </section>
        <a class="btn btn-dark" id="hide-div" onclick="hideDiv()"><i class="fas fa-times"></i></a>
    </div>
}


<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-0">
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-left">
                    <li style="margin-top:5px"><i style="font-size:25px;" class="fas fa-user-alt"></i></li>
                    <li style="margin-left:10px"><h1 style="font-family: 'Kanit', sans-serif;" class="m-0"> My Profile</h1></li>
                </ol>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item active">WebDictionary v1</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>


<div class="row scrollbar" id="style-7" style="background-color: #181A1F; color: #9FA0A2; height: 83vh; border-radius: 40px; overflow-y: auto; overflow-x: hidden;">
    <section class="col-lg-12">
        <div class="card">
            <div class="card-body" style="padding-inline: 20px; padding-block: 0; ">
                <section class="content">
                    <div class="row">
                        <section class="col-lg-6" style="display:flex;justify-content:center">
                            <div class="card">
                                <div class="card-body" style="height: 100%; max-width: 100%; max-height: 100%;">
                                    <lottie-player src="https://assets1.lottiefiles.com/private_files/lf30_fhbalxer.json"
                                                   background="transparent" speed="1" style="max-width: 100vh; max-height: 100vh;" loop autoplay></lottie-player>
                                </div>
                            </div>
                        </section>
                        <section class="col-lg-6">
                            <div class="card" style="background-color: #181A1F; color: #9FA0A2;">
                                <div class="card-body" style=" padding: 30px 20px 0px 20px">
                                    <ul class="nav nav-tabs" id="custom-content-below-tab" role="tablist" style="">
                                        <li class="nav-item" style="">
                                            <a class="nav-link active" id="custom-content-below-Profile-tab" onclick="showSaveButton()" data-toggle="pill" href="#custom-content-below-Profile" role="tab" aria-controls="custom-content-below-Profile" aria-selected="false"><i class="fas fa-user"></i> Profile</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="custom-content-below-Delete-tab" onclick="hideSaveButton()" data-toggle="pill" href="#custom-content-below-Delete" role="tab" aria-controls="custom-content-below-Delete" aria-selected="false"><i class="fas fa-trash"></i> Delete Account</a>
                                        </li>
                                    </ul>
                                    <div class="tab-content" id="custom-content-below-tabContent">
                                        <div class="tab-pane fade show active" id="custom-content-below-Profile" role="tabpanel" aria-labelledby="custom-content-below-Profile-tab">
                                            @using (Html.BeginForm("WriterProfile", "WriterPanel", FormMethod.Post))
                                            {
                                                <div class="form-group">
                                                    <br />
                                                    <div class="center-div">
                                                        <div class="image-containerr">
                                                            <label class="label" data-toggle="tooltip" title="Change your avatar">
                                                                @if (Model.WriterImage == null)
                                                                {
                                                                    <img class="rounded" id="avatar" src="~/Resources/defaultperson.png" alt="avatar" style="max-width: 200px; max-height: 200px; cursor: pointer;">
                                                                }
                                                                @if (Model.WriterImage != null)
                                                                {
                                                                    <img class="rounded" id="avatar" src="@Url.Action("GetImage", "Writer", new { id = Model.WriterID })" alt="avatar" style="max-width: 200px; max-height: 200px; cursor: pointer;">
                                                                }
                                                                <input type="file" class="sr-only" id="input" name="image" accept="image/*">
                                                            </label>
                                                            @if (Model.WriterImage == null)
                                                            {
                                                                <a class="btn btn-dark" id="cancelImagebutton" style="display: none;" onclick="cancelImageSelection()"><i class="fas fa-trash"></i></a>
                                                            }
                                                            @if (Model.WriterImage != null)
                                                            {
                                                                <a class="btn btn-dark" id="cancelImagebutton" onclick="cancelImageSelection()"><i class="fas fa-trash"></i></a>
                                                            }
                                                            <input type="text" id="inputurl" name="croppedImageUrl" hidden />
                                                        </div>
                                                    </div>
                                                    <div class="center-div">
                                                        @if (Model.WriterImage == null)
                                                        {
                                                            <a style="font-size:14px;text-align:center;" id="alert">Using a profile picture allows you to draw attention <i class="fas fa-user-astronaut"></i></a>
                                                        }
                                                        @if (Model.WriterImage != null)
                                                        {
                                                            <a style="font-size:14px;text-align:center;display:none;" id="alert">Using a profile picture allows you to draw attention <i class="fas fa-user-astronaut"></i></a>
                                                        }
                                                    </div>
                                                    @Html.TextBoxFor(x => x.WriterName, new { @class = "form-control", @placeholder = "Name" })
                                                    @Html.ValidationMessageFor(x => x.WriterName, "", new { @style = "color:red" })

                                                    @Html.TextBoxFor(x => x.WriterSurname, new { @class = "form-control", @placeholder = "Surname" })
                                                    @Html.ValidationMessageFor(x => x.WriterSurname, "", new { @style = "color:red" })

                                                    @Html.TextBoxFor(x => x.WriterTitle, new { @class = "form-control", @placeholder = "Title" })
                                                    @Html.ValidationMessageFor(x => x.WriterTitle, "", new { @style = "color:red" })

                                                    @Html.TextAreaFor(x => x.WriterAbout, 1, 15, new { @class = "form-control scrollbar", @id="style-7" , @placeholder = "About" })
                                                    @Html.ValidationMessageFor(x => x.WriterAbout, "", new { @style = "color:red" })

                                                    <div class="customtext2">
                                                        **If you change your own mail, you will be directed to the login panel to log in again.
                                                    </div>
                                                    @Html.TextBoxFor(x => x.WriterMail, new { @class = "form-control", @placeholder = "Mail" })
                                                    @Html.ValidationMessageFor(x => x.WriterMail, "", new { @style = "color:red" })

                                                    <div class="customtext2">
                                                        *If you don't want to change your password, leave this blank.
                                                    </div>
                                                    <input type="text" class="form-control" name="NewWriterPassword" placeholder="New Password" />
                                                    @if (TempData["validate"] != null)
                                                    {
                                                        <label style="color: red"> @TempData["validate"]</label>
                                                    }

                                                    @Html.HiddenFor(x => x.WriterID)
                                                    @Html.HiddenFor(x => x.WriterPassword)
                                                    <div style="text-align: right;">
                                                        <button class="btn btn-outline-light custom-button" name="btnUpdate" value="update" style="margin-top:5px;">Save Changes</button>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                        <div class="tab-pane fade" id="custom-content-below-Delete" role="tabpanel" aria-labelledby="custom-content-below-Delete-tab">
                                            <div class="form-group">
                                                <br />
                                                <div class="center-div">
                                                    <div style="" class="customtext">Ah shits... really ?</div>
                                                </div>
                                                <div style="padding-inline:25px;">
                                                    <p>
                                                        * When you close your user account, other users will not be able to send you messages.
                                                    </p>
                                                    <p>
                                                        * You can reactivate your account by logging in again.
                                                    </p>
                                                    <p>
                                                        * You will miss the opportunity to take your place in history by leaving the Dictionary.
                                                    </p>
                                                    <p>
                                                        * Remember we are always here. If you can't find us, we've already gone to space 🚀
                                                    </p>
                                                </div>
                                                <br />
                                                @using (Html.BeginForm("WriterProfile", "WriterPanel", FormMethod.Post))
                                                {
                                                    <div class="form-group">
                                                        <input type="text" class="form-control" name="validatePass" placeholder="Your Password" required />
                                                    </div>
                                                    <br />
                                                    <div class="form-group">
                                                        @Html.HiddenFor(x => x.WriterID)
                                                        <div style="text-align: right;">
                                                            <button class="btn btn-outline-danger" name="btnDelete" value="delete" style="margin-top:5px;">Goodbye my friend.. <i class="fas fa-power-off"></i></button>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <!-- /.card-body -->
                            </div>
                        </section>
                    </div>
                </section>
            </div>
        </div>
    </section>
</div>

<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Crop the image</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="img-container">
                    <img id="image" src="">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="crop">Crop</button>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script src="~/AdminLTE-3.0.4/cropper.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            var avatar = document.getElementById('avatar');
            var image = document.getElementById('image');
            var input = document.getElementById('input');
            var inputurl = document.getElementById('inputurl');
            var $modal = $('#modal');
            var cropper;           

            input.addEventListener('change', function (e) {
                var files = e.target.files;
                var done = function (url) {
                    input.value = '';
                    image.src = url;
                    $modal.modal('show');
                };
                var reader;
                var file;

                if (files && files.length > 0) {
                    file = files[0];

                    if (URL) {
                        done(URL.createObjectURL(file));
                    } else if (FileReader) {
                        reader = new FileReader();
                        reader.onload = function (e) {
                            done(reader.result);
                        };
                        reader.readAsDataURL(file);
                    }
                }
            });

            $modal.on('shown.bs.modal', function () {
                cropper = new Cropper(image, {
                    aspectRatio: 1,
                    viewMode: 3,
                });
            }).on('hidden.bs.modal', function () {
                cropper.destroy();
                cropper = null;
            });

            document.getElementById('crop').addEventListener('click', function () {
                var canvas;
                $modal.modal('hide');
                if (cropper) {
                    canvas = cropper.getCroppedCanvas({
                        width: 200,
                        height: 200,
                    });
                    avatar.src = canvas.toDataURL('image/jpeg');
                    $('#cancelImagebutton').show();
                    $('#alert').hide();
                    var croppedDataUrl = canvas.toDataURL('image/jpeg');
                    var base64Data = croppedDataUrl.split(',')[1];
                    inputurl.value = base64Data;
                    canvas.toBlob(function (blob) {
                        var formData = new FormData();
                        formData.append('avatar', blob, 'avatar.jpg');
                    });
                }
            });
        });
    </script>

    <script>
        function cancelImageSelection() {
            $('#inputurl').val('default');
            $('#avatar').attr('src', '/Resources/defaultperson.png');
            $('#cancelImagebutton').hide();
            $('#alert').show();
        }
    </script>

    <script>
        function hideDiv() {
            $('#welcome-div').hide();
        }
    </script>

    @if (ViewBag.updateresult == "true")
    {
        <script>
            $(document).ready(function () {
                Swal.fire({
                    title: 'Updated!',
                    text: 'Profile was updated successfully.',
                    icon: 'success'
                });
            });
        </script>
    }

    @if (ViewBag.validate == "true")
    {
        <script>
            $(document).ready(function () {
                Swal.fire({
                    title: 'Error!',
                    text: 'Password is not correct!',
                    icon: 'error'
                });
            });
        </script>
    }

    @if (ViewBag.pass == "true")
    {
        <script>
            $(document).ready(function () {
                Swal.fire({
                    title: 'Warning!',
                    text: 'Please enter your password.',
                    icon: 'warning'
                });
            });
        </script>
    }
}